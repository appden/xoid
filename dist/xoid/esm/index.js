import{parseSelector as n,RECORD as r,META as t,createTarget as e,USABLE as o,createNotifier as i,createCleanup as f,createGetState as u}from"@xoid/engine";export{effect,subscribe}from"@xoid/engine";var c=function(n,r,t){var e=function(n){r.node=n,r.notifier.notify()};return t&&(e=t(e)),function(r){var t="function"==typeof r?r(n()):r;e(t)}};function s(n,r,t){if(!r.length)return t;var e=r.map((function(n){return n})),o=e.shift(),i=function(n){return Array.isArray(n)?n.map((function(n){return n})):Object.create(Object.getPrototypeOf(n),Object.getOwnPropertyDescriptors(n))}(n);return i[o]=s(n[o],e,t),i}function a(n){return new Proxy({},{get:function(t,e){if(e===r)return n;var o=n.map((function(n){return n}));return o.push(e),a(o)}})}var p=function(o,i){var f=n(i),u=f.isPluck,p=f.fn,l=u?[i]:p(a([]))[r],v=o[t],y=(o[r]||[]).concat(l),g=l.some((function(n){return"symbol"==typeof n}));if(!g){var d=JSON.stringify(y);if(v.selectors||(v.selectors={}),v.selectors[d])return v.selectors[d]}var m=function(){return p(o())},O=c(m,v,(function(n){return function(r){o(),n(s(v.node,y,r))}})),b=e(m,O);if(b[t]=v,b[r]=y,!g){d=JSON.stringify(y);v.selectors[d]=b}return b};function l(n,r){if(1===arguments.length){var e=n[o],i=n[t].devtoolsHelper;return i?i(n,e):e}return p(n,r)}function v(n,r,s){var a,p={notifier:i(),node:n},l=!0,v=function(){return l||a(),p.node},y=c(v,p,s),g=e(v,y);if(g[t]=p,"function"==typeof n){l=!1;var d=f(),m=d.onCleanup,O=d.cleanupAll,b=u((function(){p.notifier.listeners.size?a():l=!1}),m);a=function(){O();var r=n(b);p.node=r,l=!0,g()!==r&&p.notifier.notify()}}return r&&"function"==typeof r&&(g[o]=r(g)),g}export{v as create,l as use};
